# Gaia 库存系统测试指南

## 📋 测试概述

已创建以下测试文件：
- `GaiaInventoryTestHelper.h/cpp` - 蓝图可调用的测试函数库
- `GaiaInventorySubsystemTest.cpp` - 自动化测试（需要配置测试框架）

## 🎮 在编辑器中手动测试

### 方法1: 使用蓝图测试（推荐）

1. **打开测试关卡**
   - 打开 `Content/Test/TestLevel.umap`

2. **创建测试蓝图**
   - 创建一个新的 Blueprint Actor 或 Level Blueprint
   - 在 Event BeginPlay 中调用测试函数

3. **调用测试函数**
   ```
   Event BeginPlay
   ├─ Run Basic Tests (GaiaInventoryTestHelper)
   └─ Print String: "测试完成"
   ```

4. **查看测试结果**
   - 按 `~` 键打开控制台
   - 输入 `log LogGaia Verbose` 查看详细日志
   - 测试结果会在输出日志中显示：
     - `[✓]` 表示测试通过
     - `[✗]` 表示测试失败

### 方法2: 使用控制台命令

1. **播放游戏** (PIE)
2. **打开控制台** (`~` 键)
3. **执行 C++ 代码**（如果配置了 Cheat Manager）

### 方法3: 创建编辑器工具

在项目设置中添加编辑器实用工具蓝图，调用测试函数。

## 🧪 测试覆盖范围

### 1. 基础功能测试
- ✅ 库存子系统初始化
- ✅ 容器创建和查找
- ✅ 物品创建和查找
- ✅ UID 唯一性验证

### 2. 容器操作测试
- ✅ 添加物品到容器
- ✅ 从容器删除物品
- ✅ 容器物品数量验证

### 3. 索引系统测试
- ✅ O(1) 物品查找性能
- ✅ 索引自动更新
- ✅ 删除物品后索引重建
- ✅ 索引一致性验证

### 4. 性能测试
- ✅ 批量创建物品（100-1000个）
- ✅ 批量查找性能测试
- ✅ 平均查找时间 < 10微秒

## 📊 测试函数说明

### `RunBasicTests`
运行完整的测试套件，包括：
- 容器创建测试
- 物品创建测试
- 添加和查找测试
- 删除测试
- 性能测试（100个物品）

**重要特性：**
- ⚠️ **遇到失败立即中止** - 第一个测试失败后会立即停止，不再执行后续测试
- 便于快速定位问题，避免后续测试的级联错误

**蓝图调用:**
```
Run Basic Tests (World Context Object)
返回值: Boolean (是否全部通过)
```

### `TestContainerCreation`
测试容器的创建、查找和UID唯一性。

### `TestItemCreation`
测试物品的创建、数量和UID唯一性。

### `TestAddAndFindItem`
测试物品添加到容器和O(1)查找功能。

### `TestRemoveItem`
测试物品删除和索引自动重建。

### `TestPerformance`
性能压力测试，可指定物品数量。

**蓝图调用:**
```
Test Performance (World Context Object, Item Count = 1000)
返回值: Boolean (性能是否达标)
```

## 🔍 查看测试结果

### 输出日志位置
- **编辑器:** `Window -> Developer Tools -> Output Log`
- **文件:** `Saved/Logs/Gaia.log`

### 日志过滤
在输出日志中输入 `LogGaia` 来过滤库存系统相关的日志。

### 测试结果格式
```
========================================
开始运行库存系统测试套件
========================================
>>> 测试: 容器创建和查找
[✓] 容器创建 通过 - 创建了3个容器，UID全部唯一
>>> 测试: 物品创建和UID唯一性
[✓] 物品创建 通过 - 创建了3个物品，数量正确，UID全部唯一
>>> 测试: 物品添加和查找
[✓] 物品添加和查找 通过 - 添加和O(1)查找功能正常
>>> 测试: 物品删除和索引重建
[✓] 物品删除 通过 - 删除功能和索引重建正常
>>> 测试: 性能测试 (物品数量: 100)
[✓] 性能测试 通过 - 创建: 2.35ms (23.50μs/个), 查找: 0.45ms (4.50μs/个)
========================================
所有测试通过！✓
========================================
```

## 🐛 常见问题

### 1. 找不到库存子系统
**问题:** 测试失败，提示"无法获取库存子系统"  
**解决:** 确保在有效的World Context中运行测试（PIE或游戏中）

### 2. 物品定义不存在
**问题:** 测试使用的 `TestItem`、`TestBackpack` 等定义不存在  
**解决:** 
- 测试代码目前使用虚拟ID，不依赖实际的DataRegistry
- 如果需要测试真实数据，请先在 DataRegistry 中创建对应的定义

### 3. 性能测试失败
**问题:** 查找时间超过10微秒  
**解决:**
- 检查是否在 Development 配置下运行（不是 Debug）
- 降低测试物品数量
- 可能是机器性能问题，关注相对性能即可

## 📈 下一步测试计划

### 待实现的测试
- [ ] 容器嵌套测试
- [ ] 循环引用检测测试
- [ ] 体积/重量计算测试
- [ ] 物品堆叠测试
- [ ] 网络复制测试
- [ ] 保存/加载测试

### 集成自动化测试框架
如需要正式的自动化测试，需要：
1. 在 `GaiaGame.Build.cs` 中添加测试模块依赖
2. 配置项目使用 Automation Testing Framework
3. 使用 `GaiaInventorySubsystemTest.cpp` 中的自动化测试

## 💡 使用建议

1. **开发阶段:** 频繁运行 `RunBasicTests` 确保核心功能正常
2. **性能优化:** 使用 `TestPerformance` 测试大量物品时的性能
3. **重构前后:** 运行完整测试套件验证功能未被破坏
4. **CI/CD:** 后期可集成自动化测试到构建流程

---

**测试文件版本:** 1.0  
**最后更新:** 2025-10-24

